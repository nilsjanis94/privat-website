<div class="inventory-container">
  <div class="inventory-header">
    <h1>Inventar-Verwaltung</h1>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="openItemDialog()">
        <mat-icon>add</mat-icon>
        Neuer Gegenstand
      </button>
      <button mat-raised-button color="accent" (click)="openCategoryDialog()">
        <mat-icon>category</mat-icon>
        Neue Kategorie
      </button>
    </div>
  </div>

  <!-- Filter-Bereich -->
  <mat-card class="filter-card">
    <mat-card-header>
      <mat-card-title>Filter</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="filter-row">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Suchen</mat-label>
          <input matInput [(ngModel)]="searchTerm" placeholder="Name, Beschreibung, Ort..." 
                 (keyup.enter)="applyFilters()">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Kategorie</mat-label>
          <mat-select [(ngModel)]="selectedCategory">
            <mat-option [value]="null">Alle Kategorien</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Zustand</mat-label>
          <mat-select [(ngModel)]="selectedCondition">
            <mat-option value="">Alle Zustände</mat-option>
            <mat-option *ngFor="let condition of conditionOptions" [value]="condition.value">
              {{ condition.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div class="filter-actions">
          <button mat-raised-button color="primary" (click)="applyFilters()">
            <mat-icon>filter_list</mat-icon>
            Filtern
          </button>
          <button mat-button (click)="clearFilters()">
            <mat-icon>clear</mat-icon>
            Zurücksetzen
          </button>
        </div>
      </div>

      <!-- Filter-Toggle für verbrauchte Items -->
      <mat-slide-toggle 
        [(ngModel)]="showConsumedItems" 
        name="showConsumedItems"
        (change)="onShowConsumedToggle()">
        Verbrauchte Items anzeigen
      </mat-slide-toggle>
    </mat-card-content>
  </mat-card>

  <!-- Kategorien-Übersicht -->
  <mat-card class="categories-card" *ngIf="!isLoadingCategories">
    <mat-card-header>
      <mat-card-title>Kategorien</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="categories-list">
        <mat-chip-set>
          <mat-chip *ngFor="let category of categories" 
                    [removable]="true" 
                    (removed)="deleteCategory(category)"
                    (click)="openCategoryDialog(category)">
            {{ category.name }} ({{ category.items_count }})
            <mat-icon matChipRemove *ngIf="category.items_count === 0">cancel</mat-icon>
          </mat-chip>
        </mat-chip-set>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Gegenstände-Tabelle -->
  <mat-card class="items-card">
    <mat-card-header>
      <mat-card-title>Gegenstände ({{ filteredItems.length }} von {{ items.length }})</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Lade Gegenstände...</p>
      </div>

      <div *ngIf="!isLoading && filteredItems.length === 0 && items.length === 0" class="empty-state">
        <mat-icon class="empty-icon">inventory</mat-icon>
        <h3>Keine Gegenstände gefunden</h3>
        <p>Fügen Sie Ihren ersten Gegenstand hinzu!</p>
        <button mat-raised-button color="primary" (click)="openItemDialog()">
          <mat-icon>add</mat-icon>
          Gegenstand hinzufügen
        </button>
      </div>

      <div *ngIf="!isLoading && filteredItems.length === 0 && items.length > 0" class="empty-state">
        <mat-icon class="empty-icon">filter_list</mat-icon>
        <h3>Keine Gegenstände entsprechen den Filtern</h3>
        <p>Versuchen Sie, die Filter zu ändern oder zurückzusetzen.</p>
        <button mat-raised-button color="primary" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Filter zurücksetzen
        </button>
      </div>

      <div *ngIf="!isLoading && filteredItems.length > 0" class="table-container">
        <table mat-table [dataSource]="filteredItems" class="items-table">
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let item">
              <div class="item-name">
                <strong>{{ item.name }}</strong>
                <small *ngIf="item.description">{{ item.description }}</small>
              </div>
            </td>
          </ng-container>

          <!-- Category Column -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Kategorie</th>
            <td mat-cell *matCellDef="let item">{{ item.category_name }}</td>
          </ng-container>

          <!-- Condition Column -->
          <ng-container matColumnDef="condition">
            <th mat-header-cell *matHeaderCellDef>Zustand</th>
            <td mat-cell *matCellDef="let item">
              <span class="condition-badge" 
                    [style.background-color]="getConditionColor(item.condition)">
                {{ getConditionLabel(item.condition) }}
              </span>
            </td>
          </ng-container>

          <!-- Location Column -->
          <ng-container matColumnDef="location">
            <th mat-header-cell *matHeaderCellDef>Ort</th>
            <td mat-cell *matCellDef="let item">{{ item.location || '-' }}</td>
          </ng-container>

          <!-- Value Column -->
          <ng-container matColumnDef="current_value">
            <th mat-header-cell *matHeaderCellDef>Wert</th>
            <td mat-cell *matCellDef="let item">
              <span *ngIf="item.current_value">
                {{ item.current_value | currency:'EUR':'symbol':'1.0-0' }}
              </span>
              <span *ngIf="!item.current_value">-</span>
            </td>
          </ng-container>

          <!-- Created Date Column -->
          <ng-container matColumnDef="created_at">
            <th mat-header-cell *matHeaderCellDef>Hinzugefügt</th>
            <td mat-cell *matCellDef="let item">{{ item.created_at | date:'short' }}</td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Aktionen</th>
            <td mat-cell *matCellDef="let item">
              <div class="action-buttons">
                <!-- Bearbeiten Button -->
                <button mat-icon-button 
                        color="primary" 
                        (click)="openItemDialog(item)"
                        title="Bearbeiten">
                  <mat-icon>edit</mat-icon>
                </button>
                
                <!-- Löschen Button -->
                <button mat-icon-button 
                        color="warn" 
                        (click)="deleteItem(item)"
                        title="Löschen">
                  <mat-icon>delete</mat-icon>
                </button>
                
                <!-- Verbraucht markieren/rückgängig -->
                <button *ngIf="!item.consumed" 
                        mat-icon-button 
                        color="accent" 
                        (click)="markAsConsumed(item)"
                        title="Als verbraucht markieren">
                  <mat-icon>restaurant</mat-icon>
                </button>
                <button *ngIf="item.consumed" 
                        mat-icon-button 
                        color="primary" 
                        (click)="unmarkAsConsumed(item)"
                        title="Verbrauch rückgängig machen">
                  <mat-icon>restore</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>
